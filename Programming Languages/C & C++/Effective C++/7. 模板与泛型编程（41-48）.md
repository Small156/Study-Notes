# Effective C++ 7. 模板与泛型编程

本文主要为 Effective C++ 条款 41 - 48 的学习与总结。

目录：

- [Effective C++ 7. 模板与泛型编程](#effective-c-7-模板与泛型编程)
  - [条款 41：了解隐式接口和编译期多态](#条款-41了解隐式接口和编译期多态)
  - [条款 42：了解 typename 的双重含义](#条款-42了解-typename-的双重含义)
  - [条款 43：学习处理模板化基类内的名称](#条款-43学习处理模板化基类内的名称)
  - [条款 44：将与参数无关的代码抽离 templates](#条款-44将与参数无关的代码抽离-templates)
  - [条款 45：运用成员函数模板接受所有兼容类型](#条款-45运用成员函数模板接受所有兼容类型)
  - [条款 46：需要类型转换时请为模板定义非成员函数](#条款-46需要类型转换时请为模板定义非成员函数)
  - [条款 47：请使用 traits classes 表现类型信息](#条款-47请使用-traits-classes-表现类型信息)
  - [条款 48：认识 template 元编程](#条款-48认识-template-元编程)
  - [参考资料](#参考资料)

## 条款 41：了解隐式接口和编译期多态

* classes 和 templates 都支持 接口（interfaces）和 多态（polymorphism）。
* classes
  * 接口是显式的（explicit），基于函数签名（函数名称、参数类型、返回类型）。
  * 多态：通过 virtual 函数发生于运行期。
* templates
  * 接口是隐式的（implicit），基于有效表达式。
    * 例如：`if(w.size() > 10 && w != X)` 得益于操作符重载和隐式类型转换等操作，不需要强制要求 `w` 成员函数 `size()`，必须返回 `int` 类型、数值类型或是其他约束，只需要保证 `if` 语句中的条件式兼容 `bool` 表达式即可。
  * 多态：通过 template 具现化和函数重载解析发生于编译期。
    * 凡是涉及到 `w` 的任何函数调用，如：`size()`、`operator>` 都有可能造成 template 具现化。
    * 同时，不同的 template 参数（即，不同类型的 `w`）会导致调用不同的函数，即表现出编译期多态。

## 条款 42：了解 typename 的双重含义

* 声明 template 参数时，前缀关键字 typename 和 class 无区别，可互换。

* 使用关键字 typename 标识嵌套从属类型名称；但不得在 base class lists（基类列）或 member initialization list（成员初值列）内以它作为 base class 修饰符。
  * 从属名称：template 内出现的相依于某个 template 参数的名称。
  * 嵌套从属名称：在 class 内呈嵌套状的名称（解析器缺省情况下认为嵌套从属名称不是类型，故需用 typename 主动说明）。

示例：

```C++
template<typename C> // 允许使用 typename 或 class
...

/* 嵌套从属类型名称示例 */

/* C::iterator 是一个嵌套从属名称，
其中 C 是一个 template 参数，而 iterator 嵌套于 C */
void f(const C &container,         // 不允许使用 typename 
       typename C::iterator iter); // 一定要使用 typename

/* 基类列与成员初值列示例 */

template<typename T>
class Derived : public Base<T>::Nested { // 基类列，不允许使用 typename
public：
    explicit Derived(int x) 
    : Base<T>::Nested(x) {} // 成员初值列，不允许使用 typename
}
```

## 条款 43：学习处理模板化基类内的名称

## 条款 44：将与参数无关的代码抽离 templates

## 条款 45：运用成员函数模板接受所有兼容类型

## 条款 46：需要类型转换时请为模板定义非成员函数

## 条款 47：请使用 traits classes 表现类型信息

## 条款 48：认识 template 元编程

## 参考资料

* 《Effective C++：改善程序与设计的55个具体做法》（第3版 中文版）
